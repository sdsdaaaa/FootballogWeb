    <!DOCTYPE html>
    <html lang="ko">
    <head>
      <meta charset="UTF-8">
      <title>ê²Œì‹œê¸€ ë³´ê¸°</title>
      <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #e3f2fd, #ffffff);
      margin: 0;
      padding: 40px;
      color: #222;
    }

    #post-box {
      background: #fff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 40px;
    }

    h1 {
      font-size: 28px;
      color: #0d47a1;
      margin-bottom: 16px;
    }

    .meta {
      font-size: 14px;
      color: #555;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .meta span {
      margin-left: 6px;
      font-weight: bold;
      color: #222;
    }

    #post-content {
      font-size: 16px;
      white-space: pre-wrap;
      margin-bottom: 30px;
      line-height: 1.7;
    }

    #comment-section {
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    #comment-section h3 {
      margin-bottom: 16px;
      color: #1565c0;
    }

    #comment-list {
      list-style: none;
      padding-left: 0;
      margin-bottom: 20px;
    }

    #comment-list li {
      margin-bottom: 10px;
      padding: 10px;
      background: #f1f8ff;
      border-radius: 8px;
    }

    input {
      width: 80%;
      padding: 10px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      padding: 10px 16px;
      background: #1565c0;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin-left: 8px;
    }

    button:hover {
      background: #0d47a1;
    }

    #post-footer {
    margin-top: 30px;
    text-align: center;
    font-size: 16px;
    color: #444;
  }

  #like-btn {
    background: none;
    border: none;
    font-size: 22px;
    color: #999;
    cursor: pointer;
    transition: transform 0.2s ease, color 0.2s ease;
  }

  #like-btn.liked {
    color: #f44336;
  }

  </style>

    </head>
    <body>

      <div id="post-footer">
        <div style="text-align: center; margin-top: 30px;">
    <button onclick="goBack()">ğŸ“‹ ëª©ë¡ìœ¼ë¡œ</button>
  </div>

    <button class="like-btn" id="like-btn">ğŸ¤</button>
    <span id="like-count">0</span> Â· ğŸ’¬ <span id="comment-count-bottom">0</span>
  </div>



      <div id="post-box">
    <h1 id="post-title"></h1>
    <div class="meta">
      ğŸ‘¤ ì‘ì„±ì: <span id="post-author"></span><br>
      ğŸ“… ë‚ ì§œ: <span id="post-date"></span><br>
      ğŸ‘ï¸ ì¡°íšŒìˆ˜: <span id="post-views"></span><br>
      ğŸ’¬ ëŒ“ê¸€ ìˆ˜: <span id="post-comments-count"></span>
    </div>
    <div id="post-content"></div>
  </div>

  <div id="comment-section">
    <h3>ğŸ’¬ ëŒ“ê¸€</h3>
    <ul id="comment-list"></ul>

    <div style="margin-top: 10px;">
      <input id="comment-input" placeholder="ëŒ“ê¸€ ì…ë ¥">
      <button id="comment-btn">ëŒ“ê¸€ ë‹¬ê¸°</button>
    </div>
  </div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
  import {
  getFirestore,
  doc,
  getDoc,
  updateDoc,
  increment,
  collection,
  addDoc,
  onSnapshot,
  query,
  orderBy,
  serverTimestamp,
  arrayUnion    // âœ… ì´ ì¤„ë§Œ ìƒë‹¨ì— ì¶”ê°€
} from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA02saQDvqMQbDLrD5UMwX848E6eFO-rUU",
    authDomain: "northern-cooler-461505-d5.firebaseapp.com",
    projectId: "northern-cooler-461505-d5",
    storageBucket: "northern-cooler-461505-d5.appspot.com",
    messagingSenderId: "57199546606",
    appId: "1:57199546606:web:b4e134094c86623e25a3ff"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const postId = new URLSearchParams(location.search).get("id");
  let currentUser = null;

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
      location.href = "login.html";
      return;
    }

    const userSnap = await getDoc(doc(db, "users", user.uid));
    currentUser = {
      uid: user.uid,
      nickname: userSnap.exists() ? userSnap.data().nickname : user.email
    };

    loadPost();
    listenComments();
    handleLikeUI();
  });

  // ê²Œì‹œê¸€ ë¡œë“œ ë° ì¢‹ì•„ìš”/ì¡°íšŒìˆ˜ ì²˜ë¦¬

  // ê²Œì‹œê¸€ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
  async function loadPost() {
    const postRef = doc(db, "posts", postId);
    await updateDoc(postRef, { views: increment(1) }); // ì¡°íšŒìˆ˜ ì¦ê°€

    onSnapshot(postRef, (snap) => {
      if (!snap.exists()) return alert("ê²Œì‹œê¸€ ì—†ìŒ");
      const post = snap.data();

      document.getElementById("post-title").innerText = post.title;
      document.getElementById("post-author").innerText = post.author || "ìµëª…";
      document.getElementById("post-date").innerText = new Date(post.date?.seconds * 1000).toLocaleString();
      document.getElementById("post-views").innerText = post.views ?? 0;
      document.getElementById("post-content").innerText = post.content;
      document.getElementById("like-count").innerText = post.likes ?? 0;
    });
  }




  // ì¢‹ì•„ìš” í† ê¸€
  function handleLikeUI() {
    const btn = document.getElementById("like-btn");
    const count = document.getElementById("like-count");
    let likedPosts = JSON.parse(localStorage.getItem("likedPosts") || "[]");
    let liked = likedPosts.includes(postId);
    btn.classList.toggle("liked", liked);
    btn.innerText = liked ? "â¤ï¸" : "ğŸ¤";

    btn.addEventListener("click", async () => {
      const postRef = doc(db, "posts", postId);
      liked = !liked;
      if (liked) {
        likedPosts.push(postId);
        await updateDoc(postRef, { likes: increment(1) });
      } else {
        likedPosts = likedPosts.filter(id => id !== postId);
        await updateDoc(postRef, { likes: increment(-1) });
      }
      localStorage.setItem("likedPosts", JSON.stringify(likedPosts));
      btn.classList.toggle("liked", liked);
      btn.innerText = liked ? "â¤ï¸" : "ğŸ¤";
    });
  }

  // ëŒ“ê¸€ ì…ë ¥

  document.getElementById("comment-btn").addEventListener("click", async () => {
    const text = document.getElementById("comment-input").value.trim();
    if (!text) return;

    const comment = {
      text,
      author: currentUser.nickname,
      uid: currentUser.uid,
      date: serverTimestamp()
    };

    try {
      await addDoc(collection(db, "posts", postId, "comments"), comment);
      document.getElementById("comment-input").value = "";
    } catch (e) {
      console.error("ëŒ“ê¸€ ì €ì¥ ì‹¤íŒ¨:", e);
      alert("ëŒ“ê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    }
  });


  // ëŒ“ê¸€ ì‹¤ì‹œê°„ ë Œë”ë§
  function listenComments() {
    const q = query(collection(db, "posts", postId, "comments"), orderBy("date", "asc"));
    onSnapshot(q, (snapshot) => {
      const comments = snapshot.docs.map(doc => doc.data());
      renderComments(comments);
    });
  }

  function renderComments(comments) {
    const list = document.getElementById("comment-list");

    list.innerHTML = comments.map(c => {
      // ë‚ ì§œ ì²˜ë¦¬: Timestamp ë˜ëŠ” Date íƒ€ì… ë‘˜ ë‹¤ ëŒ€ì‘
      let displayDate = "ë‚ ì§œ ì—†ìŒ";
      if (c.date?.seconds) {
        displayDate = new Date(c.date.seconds * 1000).toLocaleString();
      } else if (c.date instanceof Date) {
        displayDate = c.date.toLocaleString();
      }

      return `
        <li>
          <div><strong>${c.author}</strong> Â· <small>${displayDate}</small></div>
          <div>${c.text}</div>
        </li>
      `;
    }).join("");

    document.getElementById("post-comments-count").innerText = comments.length;
    document.getElementById("comment-count-bottom").innerText = comments.length;
  }


  window.goBack = function () {
    const type = new URLSearchParams(location.search).get("type") || "free";
    location.href = `board.html?type=${type}`;
  };
  </script>

    </body>
    </html>
